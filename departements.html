<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gestion des départements — Visualiseur de processus Mermaid</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      color-scheme: light dark;
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      display: flex;
      flex-direction: column;
    }

    .app-header {
      width: 100%;
      padding: 1.5rem clamp(1.5rem, 5vw, 3rem);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 1.25rem;
      background: linear-gradient(135deg, rgba(37, 99, 235, 0.35), rgba(14, 165, 233, 0.18));
      border-bottom: 1px solid rgba(148, 163, 184, 0.25);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.55);
      backdrop-filter: blur(14px);
      position: sticky;
      top: 0;
      z-index: 3;
    }

    .app-header__info {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    h1 {
      margin: 0;
      font-size: clamp(1.4rem, 2.3vw, 2rem);
      font-weight: 600;
      color: #93c5fd;
    }

    .app-header__info p {
      margin: 0;
      color: rgba(226, 232, 240, 0.78);
      font-size: 0.98rem;
      line-height: 1.5;
    }

    .app-header__meta {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      align-items: flex-end;
    }

    .app-header__status {
      padding: 0.4rem 0.9rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.55);
      color: #bfdbfe;
      font-weight: 600;
      font-size: 0.85rem;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.45);
    }

    .app-header__nav {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.55);
      box-shadow: 0 12px 32px rgba(15, 23, 42, 0.35);
    }

    .app-header__link {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.45rem 0.9rem;
      border-radius: 999px;
      text-decoration: none;
      color: #e2e8f0;
      font-weight: 600;
      font-size: 0.85rem;
      transition: background 0.2s ease, color 0.2s ease, transform 0.2s ease;
    }

    .app-header__link:hover,
    .app-header__link:focus-visible {
      background: rgba(37, 99, 235, 0.35);
      transform: translateY(-1px);
      outline: none;
    }

    .app-header__link[aria-current="page"] {
      background: linear-gradient(135deg, #60a5fa, #38bdf8);
      color: #0b1220;
      box-shadow: 0 12px 28px rgba(59, 130, 246, 0.35);
    }

    main {
      flex: 1;
      display: grid;
      grid-template-columns: clamp(320px, 30vw, 420px) minmax(340px, 1fr);
      gap: clamp(1.5rem, 3vw, 2.75rem);
      padding: clamp(1.5rem, 3vw, 3rem);
      background: radial-gradient(circle at top left, rgba(37, 99, 235, 0.35), transparent 55%),
        radial-gradient(circle at bottom right, rgba(14, 165, 233, 0.25), transparent 50%);
    }

    @media (max-width: 960px) {
      main {
        grid-template-columns: 1fr;
      }
    }

    .side-panel {
      position: relative;
      border: 1px solid rgba(148, 163, 184, 0.35);
      border-radius: 22px;
      background: rgba(15, 23, 42, 0.68);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.55);
      overflow: hidden;
    }

    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .icon-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      border: 1px solid rgba(148, 163, 184, 0.4);
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.45);
      color: inherit;
      font: inherit;
      font-size: 0.85rem;
      padding: 0.35rem 0.55rem;
      cursor: pointer;
      transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
    }

    .icon-button:hover,
    .icon-button:focus-visible {
      background: rgba(37, 99, 235, 0.25);
      border-color: rgba(59, 130, 246, 0.55);
      color: #bfdbfe;
      outline: none;
    }

    .panel-body {
      padding: clamp(1.5rem, 2.5vw, 2rem);
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .info-header h2 {
      margin: 0;
      font-size: 1.15rem;
      color: #bfdbfe;
    }

    .info-header p {
      margin: 0.35rem 0 0;
      font-size: 0.95rem;
      color: rgba(226, 232, 240, 0.75);
      line-height: 1.5;
    }

    .entity-section {
      display: flex;
      flex-direction: column;
      gap: 1.15rem;
    }

    .entity-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
    }

    .entity-header h3 {
      margin: 0;
      font-size: 1.05rem;
      color: #93c5fd;
    }

    .secondary-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
      padding: 0.45rem 0.85rem;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.35);
      color: #bfdbfe;
      font-size: 0.85rem;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
    }

    .secondary-button:hover,
    .secondary-button:focus-visible {
      background: rgba(37, 99, 235, 0.25);
      border-color: rgba(59, 130, 246, 0.55);
      color: #e0f2fe;
      outline: none;
    }

    .entity-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .entity-list:empty::before {
      content: attr(data-empty-text);
      font-size: 0.88rem;
      color: rgba(226, 232, 240, 0.55);
    }

    .department-tree {
      gap: 1rem;
    }

    .department-node {
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
    }

    .role-list {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      margin-left: 1.65rem;
      padding-left: 1.1rem;
      border-left: 1px solid rgba(148, 163, 184, 0.35);
    }

    .role-list:empty::before {
      content: attr(data-empty-text);
      font-size: 0.82rem;
      color: rgba(226, 232, 240, 0.5);
    }

    .entity-row {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 0.75rem;
      align-items: center;
      padding: 0.65rem 0.75rem;
      border-radius: 14px;
      background: rgba(15, 23, 42, 0.55);
      border: 1px solid rgba(148, 163, 184, 0.35);
      transition: border-color 0.2s ease, background 0.2s ease, box-shadow 0.2s ease;
    }

    .entity-row[data-entity-type='department'] {
      grid-template-columns: auto minmax(0, 1fr) auto auto auto;
    }

    .entity-row[data-entity-type='role'] {
      grid-template-columns: minmax(0, 1fr) auto auto;
    }

    .department-collapse {
      width: 2rem;
      height: 2rem;
    }

    .department-collapse-icon {
      transition: transform 0.2s ease;
      font-size: 0.95rem;
    }

    .department-node[data-collapsed='true'] .role-list {
      display: none;
    }

    .entity-row.is-selected {
      border-color: rgba(96, 165, 250, 0.75);
      background: rgba(37, 99, 235, 0.18);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4);
    }

    .entity-input {
      width: 100%;
      border: none;
      background: transparent;
      color: inherit;
      font-size: 0.95rem;
      font-family: inherit;
      line-height: 1.4;
    }

    .entity-input::placeholder {
      color: rgba(226, 232, 240, 0.45);
    }

    .entity-input:focus {
      outline: none;
    }

    .entity-color {
      -webkit-appearance: none;
      appearance: none;
      width: 2.25rem;
      height: 2.25rem;
      border: none;
      border-radius: 10px;
      background: transparent;
      padding: 0;
      cursor: pointer;
    }

    .entity-color::-webkit-color-swatch-wrapper {
      padding: 0;
    }

    .entity-color::-webkit-color-swatch {
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .entity-color::-moz-color-swatch {
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    .add-role-button {
      padding: 0.45rem 0.85rem;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.35);
      color: inherit;
      font-size: 0.85rem;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
    }

    .add-role-button:hover,
    .add-role-button:focus-visible {
      background: rgba(37, 99, 235, 0.2);
      border-color: rgba(59, 130, 246, 0.5);
      color: #bfdbfe;
      outline: none;
    }

    .helper-text {
      margin: 0;
      font-size: 0.85rem;
      color: rgba(226, 232, 240, 0.6);
      line-height: 1.6;
    }

    .detail-workspace {
      border: 1px solid rgba(148, 163, 184, 0.35);
      border-radius: 22px;
      background: rgba(15, 23, 42, 0.62);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.55);
      padding: clamp(1.6rem, 2.8vw, 2.4rem);
      display: flex;
      flex-direction: column;
      gap: 1.75rem;
    }

    .detail-header h2 {
      margin: 0;
      font-size: 1.25rem;
      color: #bfdbfe;
    }

    .detail-header p {
      margin: 0.4rem 0 0;
      color: rgba(226, 232, 240, 0.7);
      font-size: 0.96rem;
      line-height: 1.6;
    }

    .detail-empty {
      border: 1px dashed rgba(148, 163, 184, 0.4);
      border-radius: 18px;
      padding: 1.5rem;
      text-align: center;
      font-size: 0.95rem;
      color: rgba(226, 232, 240, 0.65);
      background: rgba(15, 23, 42, 0.35);
    }

    .detail-form {
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    .detail-grid {
      display: grid;
      gap: 1.25rem;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    .detail-field {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .detail-field label {
      font-weight: 600;
      font-size: 0.85rem;
      color: rgba(191, 219, 254, 0.9);
    }

    .detail-field input,
    .detail-field textarea {
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.75);
      color: #e2e8f0;
      font: inherit;
      padding: 0.7rem 0.85rem;
      resize: vertical;
      min-height: 2.75rem;
    }

    .detail-field input:focus,
    .detail-field textarea:focus {
      outline: none;
      border-color: rgba(96, 165, 250, 0.7);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.25);
    }

    .detail-field textarea {
      min-height: 5.5rem;
    }

    .detail-divider {
      border: 0;
      border-top: 1px solid rgba(148, 163, 184, 0.25);
      margin: 0;
    }

    .detail-selection-summary {
      margin: 0;
      font-size: 0.92rem;
      color: rgba(226, 232, 240, 0.75);
    }

    .detail-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
    }

    .detail-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.45);
      font-size: 0.82rem;
      color: rgba(226, 232, 240, 0.78);
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
    }

    .metric-card {
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.45);
      padding: 1rem 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .metric-card span {
      display: block;
    }

    .metric-value {
      font-size: 1.65rem;
      font-weight: 600;
      color: #93c5fd;
    }

    .metric-label {
      font-size: 0.85rem;
      color: rgba(226, 232, 240, 0.65);
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    .tips-list {
      margin: 0;
      padding-left: 1.2rem;
      font-size: 0.9rem;
      color: rgba(226, 232, 240, 0.7);
      display: grid;
      gap: 0.4rem;
    }

    .tips-list li::marker {
      color: rgba(96, 165, 250, 0.65);
    }

    @media (max-width: 600px) {
      .detail-field textarea {
        min-height: 4.25rem;
      }
    }
  </style>
</head>
<body>
  <header class="app-header">
    <div class="app-header__info">
      <h1>Gestion des départements et des rôles</h1>
      <p>Structurez votre organisation et capturez les informations essentielles pour chaque équipe et rôle clé.</p>
    </div>
    <div class="app-header__meta">
      <span class="app-header__status">Administration des équipes</span>
      <nav class="app-header__nav" aria-label="Navigation globale">
        <a class="app-header__link" href="index.html">Accueil</a>
        <a class="app-header__link" href="departements.html" aria-current="page">Départements &amp; Rôles</a>
        <a class="app-header__link" href="diagram.html">Diagramme</a>
      </nav>
    </div>
  </header>
  <main>
    <aside class="side-panel info-panel" data-side="left">
      <div class="panel-body" id="org-panel" role="region" aria-label="Arborescence des départements">
        <header class="info-header">
          <h2>Arborescence de l'organisation</h2>
          <p id="org-summary">Ajoutez vos départements et imbriquez les rôles pour cartographier votre structure.</p>
        </header>
        <section class="entity-section" aria-labelledby="departments-title">
          <div class="entity-header">
            <h3 id="departments-title">Départements</h3>
            <button id="add-department" class="secondary-button" type="button">Ajouter un département</button>
          </div>
          <div
            id="department-list"
            class="entity-list department-tree"
            data-empty-text="Ajoutez des départements pour commencer à organiser vos équipes."
            role="list"
            aria-labelledby="departments-title"
          ></div>
          <p class="helper-text">Cliquez sur un département ou un rôle pour gérer ses détails et ses responsabilités.</p>
        </section>
      </div>
    </aside>
    <section class="detail-workspace" aria-labelledby="detail-title">
      <header class="detail-header">
        <h2 id="detail-title">Détails de l'équipe</h2>
        <p id="detail-description">Sélectionnez un élément de l'arborescence pour compléter les informations facultatives et suivre les contacts clés.</p>
      </header>
      <p id="detail-selection-summary" class="detail-selection-summary" hidden></p>
      <div id="detail-empty" class="detail-empty">
        Sélectionnez un département ou un rôle dans le panneau de gauche pour afficher ses informations et compléter les champs facultatifs.
      </div>
      <form id="detail-form" class="detail-form" hidden novalidate>
        <div class="detail-grid">
          <div class="detail-field">
            <label for="detail-name">Nom</label>
            <input id="detail-name" type="text" placeholder="Nommer l'élément sélectionné" autocomplete="off" />
          </div>
          <div class="detail-field">
            <label for="detail-color">Couleur</label>
            <input id="detail-color" type="color" aria-label="Couleur de l'élément sélectionné" />
          </div>
        </div>
        <hr class="detail-divider" />
        <div class="detail-field" data-entity="department">
          <label for="detail-department-lead">Responsable</label>
          <input id="detail-department-lead" type="text" placeholder="Nom du responsable du département" data-meta-key="lead" data-entity="department" />
        </div>
        <div class="detail-field" data-entity="department">
          <label for="detail-department-description">Description</label>
          <textarea id="detail-department-description" placeholder="Décrivez la mission principale du département" data-meta-key="description" data-entity="department"></textarea>
        </div>
        <div class="detail-field" data-entity="department">
          <label for="detail-department-objectives">Objectifs</label>
          <textarea id="detail-department-objectives" placeholder="Listez les objectifs prioritaires" data-meta-key="objectives" data-entity="department"></textarea>
        </div>
        <div class="detail-field" data-entity="department">
          <label for="detail-department-notes">Notes complémentaires</label>
          <textarea id="detail-department-notes" placeholder="Ajoutez des notes libres ou des points d'attention" data-meta-key="notes" data-entity="department"></textarea>
        </div>
        <div class="detail-field" data-entity="role" hidden>
          <label for="detail-role-owner">Titulaire du rôle</label>
          <input id="detail-role-owner" type="text" placeholder="Personne occupant le rôle" data-meta-key="owner" data-entity="role" />
        </div>
        <div class="detail-field" data-entity="role" hidden>
          <label for="detail-role-responsibilities">Responsabilités</label>
          <textarea id="detail-role-responsibilities" placeholder="Décrivez les responsabilités principales" data-meta-key="responsibilities" data-entity="role"></textarea>
        </div>
        <div class="detail-field" data-entity="role" hidden>
          <label for="detail-role-skills">Compétences clés</label>
          <textarea id="detail-role-skills" placeholder="Compétences ou certifications requises" data-meta-key="skills" data-entity="role"></textarea>
        </div>
        <div class="detail-field" data-entity="role" hidden>
          <label for="detail-role-notes">Notes complémentaires</label>
          <textarea id="detail-role-notes" placeholder="Ajoutez des notes libres ou des points d'attention" data-meta-key="notes" data-entity="role"></textarea>
        </div>
      </form>
      <div class="detail-badges" id="detail-badges" hidden></div>
      <div class="metrics-grid">
        <article class="metric-card">
          <span class="metric-value" id="metric-departments-count">0</span>
          <span class="metric-label">Départements suivis</span>
        </article>
        <article class="metric-card">
          <span class="metric-value" id="metric-roles-count">0</span>
          <span class="metric-label">Rôles documentés</span>
        </article>
        <article class="metric-card">
          <span class="metric-value" id="metric-details-count">0</span>
          <span class="metric-label">Fiches enrichies</span>
        </article>
      </div>
      <section aria-label="Conseils de structuration">
        <ul class="tips-list">
          <li>Assignez une couleur par département pour les retrouver facilement dans le diagramme.</li>
          <li>Renseignez les notes pour partager le contexte avec vos équipes transverses.</li>
          <li>Ajoutez les rôles directement dans l'arborescence pour garder une vision hiérarchique.</li>
        </ul>
      </section>
    </section>
  </main>
  <script type="module" src="departements.js"></script>
</body>
</html>
